## todo list

- [ ] 语义增强，问的时候太死板了
- [ ] SQL复用，问的SQL收藏了，下次直接用
- [ ] 开发Springboot版本对接Sqlbot的openApi的接口
- [ ] 开发Spring-ai版本的SQLBot
- [ ] 基于数据源探查表的建表质量
- [ ] 基于数据源小的表，探查数据质量
- [ ] 引入plan，可进行复杂任务分析，中间过程支持自动创建临时表
- [ ] 基于数据源的表，结合DATAX完成几句话同步一个表的数据

### 计划
- [ ]  **T1 语义增强（v0）**
    - [ ]  T1.1 建立 `semantic_dict v0`：从表/字段注释与 Top50 历史问法抽取别名/缩写/中英混同义
    - [ ]  T1.2 规则改写器：同义词替换、拼写变体、值标准化（如“北区/华北”统一）
    - [ ]  T1.3 LLM 改写兜底（可开关），记录“原始问法→改写问法→SQL”
    - [ ]  T1.4 A/B 回放验证（20 条基线）：成功率提升 ≥ 15%，误改 ≤ 5%
    - [ ]  T1.5 灰度与回退：Feature Flag + 告警（异常率阈值触发回退）
- [ ]  **T2 SQL 复用（收藏/模板化/直达）**
    - [ ]  T2.1 建表 `sql_library`（id,title,tags,datasource_id,sql,params_schema,verified,last_used_at）
    - [ ]  T2.2 API：保存/检索/打标签/参数校验（必填、类型、默认值）
    - [ ]  T2.3 UI：一键收藏、搜索、最近使用、模板变量填写
    - [ ]  T2.4 健康巡检：周期性可执行性检测 + 失效告警
    - [ ]  T2.5 统计面板：复用次数、失败率、Top 模板
- [ ]  **T3 Spring Boot 客户端对接 SQLBot OpenAPI**
    - [ ]  T3.1 `sqlbot-client-spring` Maven 包骨架（DTO、鉴权拦截、错误映射）
    - [ ]  T3.2 稳定性：超时、重试、熔断（Resilience4j）
    - [ ]  T3.3 Trace：OTel/Zipkin 全链路 traceId 贯通
    - [ ]  T3.4 示例：上传 Excel、问数、收藏复用 3 个端到端 Demo
    - [ ]  T3.5 契约回归：OpenAPI 契约测试
- [ ]  **T4 Spring AI 版 NL→SQL 链（影子模式）**
    - [ ]  T4.1 组件链：Intent→Rewrite→SQLGen→Guardrail→Exec→Format 可插拔
    - [ ]  T4.2 配置化：yml 切模型/温度/重试策略
    - [ ]  T4.3 影子回放：对历史会话跑链路，正确性一致性 ≥ 85%
    - [ ]  T4.4 节点级埋点：耗时/失败点位/Prompt 版本
    - [ ]  T4.5 回滚策略：链路异常自动切回现有 SQLBot
- [ ]  **T5 建表质量（Schema Lint/Scorecard）**
    - [ ]  T5.1 指标体系：命名规范、主键/唯一键、外键覆盖、注释率、索引选择性、时间列、敏感列
    - [ ]  T5.2 扫描器：information_schema + 系统 catalog
    - [ ]  T5.3 评分模型：Σ(weight×metric)，权重可配模板
    - [ ]  T5.4 报告：JSON + Markdown（Top-10 问题与修复建议）
    - [ ]  T5.5 与标注联动：低分表优先治理
- [ ]  **T6 小表数据质量探查（内容侧）**
    - [ ]  T6.1 目标表筛选：行数阈值 N、白名单/黑名单
    - [ ]  T6.2 指标：缺失率、唯一性、分布、日期异常、外键存在性、枚举合法性、IQR/3σ
    - [ ]  T6.3 报告与阈值告警（HTML/Markdown）
    - [ ]  T6.4 抽样策略：整表/分层抽样可配置
    - [ ]  T6.5 误报分析与阈值回调
- [ ]  **T7 复杂任务 Plan + 临时表**
    - [ ]  T7.1 Planner：规则+LLM 生成 PlanGraph（节点=SQL 步骤，边=依赖）
    - [ ]  T7.2 Executor：顺序/并行执行、临时表命名 `tmp_{planId}_{step}`、TTL 清理
    - [ ]  T7.3 审计与复跑：PlanID 绑定输入/输出/SQL/耗时
    - [ ]  T7.4 典型用例 3 个跑通（留存分析、贡献度拆解、窗口期对比）
    - [ ]  T7.5 资源与权限：会话级限额 + 行为审计
- [ ]  **T8 NL→DataX 单表同步（几句话完成）**
    - [ ]  T8.1 语义解析：源/目标/字段映射/主键/增量字段/模式（覆盖/追加/去重）
    - [ ]  T8.2 生成 `DataX JSON`：类型映射与连通性预校验
    - [ ]  T8.3 运行器：启动/日志/失败重试/结果回传
    - [ ]  T8.4 5 个典型场景端到端验证（全量/增量/CSV→PG/PG→ES/去重导入）
    - [ ]  T8.5 监控：吞吐、首包时延、失败诊断归因